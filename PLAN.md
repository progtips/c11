# План реализации функций кнопок обработки статей

## Обзор задачи

Необходимо реализовать функциональность для трех кнопок:
- **"О чем статья"** - генерация краткого описания статьи
- **"Тезисы"** - извлечение основных тезисов статьи
- **"Пост для Telegram"** - создание поста для Telegram на основе статьи

## Текущее состояние

- ✅ Реализован парсинг статей (`/api/parse/route.js`)
- ✅ Реализован перевод статей (`/api/translate/route.js`)
- ✅ UI с кнопками уже создан (`app/page.js`)
- ⚠️ Кнопки "О чем статья", "Тезисы" и "Пост для Telegram" пока показывают заглушки

## Порядок действий

### Этап 1: Создание API-роутов для обработки статей

#### 1.1. Создание API-роута для "О чем статья"
**Файл:** `app/api/summary/route.js`

**Действия:**
- Создать новый API-роут POST `/api/summary`
- Принимать в теле запроса: `{ article: { title, content, date } }` или `{ url: string }`
- Если передан `url`, сначала выполнить парсинг статьи
- Использовать OpenRouter API (как в `/api/translate/route.js`) для генерации краткого описания
- Системный промпт: "Ты эксперт по анализу текстов. Прочитай следующую статью и напиши краткое описание (2-3 предложения) о чем она. Описание должно быть на русском языке."
- Вернуть результат в формате: `{ summary: string }`

#### 1.2. Создание API-роута для "Тезисы"
**Файл:** `app/api/thesis/route.js`

**Действия:**
- Создать новый API-роут POST `/api/thesis`
- Принимать в теле запроса: `{ article: { title, content, date } }` или `{ url: string }`
- Если передан `url`, сначала выполнить парсинг статьи
- Использовать OpenRouter API для извлечения тезисов
- Системный промпт: "Ты эксперт по анализу текстов. Прочитай следующую статью и выдели 5-7 основных тезисов. Каждый тезис должен быть кратким (одно предложение). Ответ должен быть на русском языке, каждый тезис на новой строке с маркером списка."
- Вернуть результат в формате: `{ thesis: string }`

#### 1.3. Создание API-роута для "Пост для Telegram"
**Файл:** `app/api/telegram/route.js`

**Действия:**
- Создать новый API-роут POST `/api/telegram`
- Принимать в теле запроса: `{ article: { title, content, date } }` или `{ url: string }`
- Если передан `url`, сначала выполнить парсинг статьи
- Использовать OpenRouter API для создания поста
- Системный промпт: "Ты эксперт по созданию контента для социальных сетей. На основе следующей статьи создай пост для Telegram. Пост должен быть: 1) Привлекательным и цепляющим, 2) Содержать краткое описание статьи, 3) Быть структурированным с использованием эмодзи, 4) Иметь длину 200-400 слов, 5) Быть на русском языке. Используй форматирование Markdown для Telegram."
- Вернуть результат в формате: `{ post: string }`

### Этап 2: Обновление фронтенда

#### 2.1. Обновление функции `handleSubmit` в `app/page.js`

**Действия:**
- Заменить заглушку в функции `handleSubmit` на реальные вызовы API
- Добавить проверку наличия распарсенной статьи (`parsedArticle`) или URL
- Реализовать логику вызова соответствующих API-роутов:
  - Для `summary` → `/api/summary`
  - Для `thesis` → `/api/thesis`
  - Для `telegram` → `/api/telegram`
- Передавать в API либо `parsedArticle`, либо `url` (если статья еще не распарсена)
- Обработать ответы и отобразить результаты в блоке результата
- Добавить обработку ошибок с понятными сообщениями

#### 2.2. Оптимизация UX

**Действия:**
- Убедиться, что кнопки "О чем статья", "Тезисы" и "Пост для Telegram" работают даже если статья еще не распарсена (тогда парсинг выполнится на бэкенде)
- Добавить индикацию загрузки для каждой кнопки (уже реализовано через `activeButton`)
- Улучшить отображение результатов (особенно для тезисов и Telegram-поста)

### Этап 3: Обработка ошибок и валидация

#### 3.1. Валидация входных данных

**Действия:**
- Проверить наличие обязательных полей в запросах
- Валидировать формат URL (если передан)
- Проверить наличие API ключа OpenRouter в переменных окружения

#### 3.2. Обработка ошибок API

**Действия:**
- Добавить обработку ошибок сети
- Обработать ошибки OpenRouter API (лимиты, неверный ключ и т.д.)
- Добавить понятные сообщения об ошибках для пользователя
- Логировать ошибки в консоль для отладки

### Этап 4: Тестирование

#### 4.1. Функциональное тестирование

**Действия:**
- Протестировать каждую кнопку с реальной статьей
- Проверить работу с уже распарсенной статьей
- Проверить работу с URL (когда статья еще не распарсена)
- Проверить обработку ошибок (неверный URL, отсутствие API ключа и т.д.)

#### 4.2. Тестирование производительности

**Действия:**
- Проверить время отклика API
- Убедиться, что индикаторы загрузки работают корректно
- Проверить работу с длинными статьями

## Технические детали

### Используемые технологии
- **Next.js 14** - фреймворк
- **OpenRouter API** - для AI-обработки текста
- **Cheerio** - для парсинга HTML (уже используется)

### Структура API-запросов

Все три API-роута будут иметь схожую структуру:
```javascript
POST /api/{summary|thesis|telegram}
Body: {
  article?: { title, content, date },
  url?: string
}
Response: {
  result: string,
  error?: string
}
```

### Переменные окружения

Убедиться, что в `.env.local` присутствует:
```
OPENROUTER_API_KEY=your_api_key_here
```

## Последовательность реализации

1. **Сначала** создать все три API-роута (`/api/summary`, `/api/thesis`, `/api/telegram`)
2. **Затем** обновить фронтенд для использования этих API
3. **После** добавить обработку ошибок и валидацию
4. **В конце** провести тестирование всех функций

## Примечания

- Все три функции используют один и тот же подход: парсинг статьи (если нужно) + AI-обработка через OpenRouter
- Можно вынести общую логику парсинга в отдельную утилиту, если потребуется
- Системные промпты можно будет доработать после тестирования для улучшения качества результатов

